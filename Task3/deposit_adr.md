<style>
    .heatMap th {
        background: grey;
        word-wrap: break-word;
        text-align: center;
    }
</style>

### <a name="_b7urdng99y53"></a>**Название задачи: Открытие депозитов онлайн**
### <a name="_hjk0fkfyohdk"></a>**Автор: Леонид Смирнов**
### <a name="_uanumrh8zrui"></a>**Дата: 09.07.2025**

### <a name="_3bfxc9a45514"></a>**Функциональные требования**

<div class="heatMap">


|  **№**  | **Действующие лица или системы**             | **Use Case**                           | **Описание**                                                                                                                                                                                                                                     |
|:-------:|:---------------------------------------------|:---------------------------------------|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **UC1** | Клиент, сайт                                 | Новый клиент через веб-сайт            | * Клиент попадает на веб-сайт банка. <br/> * Клиент видит там текущие процентные ставки по депозитам. <br/> * Клиент заносит свои данные для открытия депозита                                                                                   |
| **UC2** | Оператор кол-центра, ПО кол-центра, СМС-шлюз | Подтверждение клиента через веб-сайт   | * Оператор кол-центра связывается с клиентом для уточнения его данных и запуска дальнейшего флоу. <br/> * Оператор заносит новую заявку на депозит. <br/> *  Клиенту приходит СМС с подтверждением.                                              |
| **UC3** | Клиент, интернет-банк                        | Заведение депозита через интернет-банк | * Клиент открывает личный кабинет в интернет-банке. <br/> * Клиент выбирает персонализированное предложение для открытия вклада.                                                                                                                 |
| **UC4** | Клиент, менеджер фронт-офиса, АБС, СМС-шлюз  | Подтверждение депозита                 | * Клиент физически объявляется в отделении банка. <br/> * Менеджер проверяет его данные. <br/> Клиенту приходит СМС с кодом подтверждения операции. <br/> Менеджер подтверждает операцию через OTP. <br/> Клиенту приходит СМС с подтверждением. |
| **UC5** | Клиент, интернет-банк, АБС, СМС-шлюз         | Закрытие депозита                      | * Клиент заходит в личный кабинет интернет-банка. <br/> * Портал отображает список активных депозитов. <br/> * Клиент аннулирует депозит. <br/> Клиенту приходит СМС с подтверждением.                                                           |




### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| **№** | **Требование**                                                    |
|:-----:|:------------------------------------------------------------------|
|  R1   | Система должна быть доступа 24/7                                  |
|  R2   | Аптайм должен быть не ниже чем 99,9%                              |
|  R4   | Должен быть настроен механизм бэкапов                             |
|  R5   | Масштабирование (горизонтальное для своего, вертикальное для АБС) |
|  P1   | Отклик по операциям должен составлять миллисекунды                |
|  P2   | Системы должны выдерживать рост нагрузки из-за наплыва клиентов   |
|  S1   | Используем преимущественно уже имеющийся стэк                     |
|  +R3  | В качестве шины сообщений используем Apache Kafka                 |
|  +R4  | Используем преимущественно уже имеющиеся технологии               |

</div>

### <a name="_qmphm5d6rvi3"></a>**Решение**
Диаграммы:

[Контекст](./context.puml)

[Контейнеры](./container.puml)

Главные архитектурные изменения - это переход на микросервисную архитектуру и трансформация АБС из древнего гомункула в микросервис.
Вкупе они позволят нам обеспечить человеческое масштабирование под нагрузкой, а также исключат необходимость обмена экселями по почте, т.к. АБС 
сможет предоставлять необходимые данные через RBAC.

Этот шаг крайне (самый) объемный и сложный, но его надо реализовать именно на этапе MVP, ибо так и так придется это делать, а после запуска выйдет куда накладнее.

Кеширование и репликация в БД сервисов поможет добиться желанной скорости выполнения операций меньше чем за секунду.

Стэк в данном случае остается прежний. Единственное изменение - это C# 12 и .NET 9 для новой итерации АБС, но это не станет проблемой, т.к. сам банк
написан на .NET Framework.

Во вводной не указано, какие системы контейнеризации используются, но все заявленное хорошо играется с Кубером (и Windows-контейнеры в том числе).

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Если переделка АБС невозможна, то можно навесить на нее CQRS - пусть транзакции пишутся в одну базу и реплицируются в реплику на чтение.

Минимально необходимо прикрутить к АБС REST API и веб-интерфейс, а саму базу оставить как есть - у нас жесткое нарушение вменяемости 
из-за того, что другие сервисы ходят в постгрес АБС напрямую. В команде поддержки есть джависты, управятся на раз-два.

### <a name="_bjrr7veeh80c"></a>**Недостатки, ограничения, риски**

* Перепиливание старой АБС на новую - очень трудозатратный процесс, так что с таким списком работ на MVP можно не уложиться в бюджет и сроки;
* Мы не меняем стэк БД (Oracle, SQL Server) - в любой момент их могут запретить или попросту нельзя будет продлить лицензию;
* Клиент банка остается монолитом на .NET Framework'e - опять-таки можем лишиться лицензий на Windows, могут быть проблемы с производительностью из-за устаревшего стэка;
