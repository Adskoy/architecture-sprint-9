### <a name="_b7urdng99y53"></a>**Название задачи:Передача ставок в кол-центр**
### <a name="_hjk0fkfyohdk"></a>**Автор: Леонид Смирнов**
### <a name="_uanumrh8zrui"></a>**Дата: 09.07.2025**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

| **№** | **Действующие лица или системы**                                                     | **Use Case**                                   | **Описание**                                                                                                                                                                          |
|:-----:|:-------------------------------------------------------------------------------------|:-----------------------------------------------|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  UC1  | * Клиент <br/> * Оператор кол-центра <br/> * ПО кол-центра                           | Запрос информации о ставках                    | * Клиент дозванивается до внутреннего кол-центра <br/> * Оператор запрашивает у системы кол-центра информацию о текущих ставках. <br/> * Оператор предоставляет информацию клиенту.   |
|  UC2  | * Клиент <br/> * Оператор партнерского кол-центра <br/> * ПО партнерского кол-центра | Запрос информации о ставках                    | * Клиент дозванивается до партнерского кол-центра <br/> * Оператор запрашивает у системы кол-центра информацию о текущих ставках. <br/> * Оператор предоставляет информацию клиенту.  |
|  UC3  | * АБС <br/> * Почтовый сервис <br/> ПО партнерского кол-центра                       | Передача информации о текущих ставках партнеру | * По крону запускается джоба, запрашивающая текущие ставки в АБС. <br/> Результат пишется в CSV и отправляется письмом партнеру. <br/> * Партнерское ПО обрабатывает полученный файл. |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**
Опишите здесь нефункциональные требования и архитектурно-значимые требования.


| **№** | **Требование**                 |
|:-----:|:-------------------------------|
|   1   | Файловый обмен                 |
|   2   | Без API вызовов                |
|   3   | Данные должны быть актуальными |


### <a name="_qmphm5d6rvi3"></a>**Решение**

[Контекст](./context.puml)

[Контейнеры](./container.puml) (все ненужное для текущего шага удалено)

Решение незамысловатое. По крону или иному триггеру в АБС запускается джоба на вычисление новый ставок по депозитам.

Результат вычислений публикуется в кафку, после чего реплицируется в БД внутреннего кол-центра и пишется в его кэш.
На данном этапе наши операторы могут без проблем предоставлять клиентам актуальную информацию по ставкам.

Дополнительно результат вычислений пишется в JSON/XML/CSV файл и отправляется по почте в партнерский кол-центр.
Что они с ним дальше сделают - загадка, но мы на нее уже не повлияем.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Альтернативой стало бы допиливание партнерской системы до того состояния, когда она сможет по REST запросить текущие ставки из АБС.
На худой конец можно было бы научить ее ходить в S3 и публиковать файл в минио, а не отправлять по почте.
Но это потребует от партнеров доработки их ПО, что не факт что свершится.

**Недостатки, ограничения, риски**

* Файловый обмен между системами - одна из самых ужасных идей, что может прийти кому-либо в голову. Особенно если этот файл отправляют по почте.
* Используя посредник (почтовый сервис) мы получаем дополнительную точку отказа.
* Данные должны быть актуальными (деньги, как-никак). Использование эмейла добавляет ощутимый лаг к передаче данных партнеру.
* Используемая push-модель подразумевает постоянную нагрузку на АБС. С повышением скважности вычислений ради увеличения точности ставок нагрузка будет расти.
Этого можно избежать, если запрашивать данные только через API и вычислять из в момент первого запроса к кэшу. Впрочем, если ставки обновляются раз в сутки, то не страшно.

